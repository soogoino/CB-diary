# 用戶故事 (User Stories)

## 專案背景
貞操日記 Android 應用程式 - 為貞操裝置佩戴者提供每日記錄、統計分析和個人管理功能。

---

## Epic 1: 用戶認證與隱私保護

### US-001: 應用程式鎖定保護
**作為** 一位應用程式用戶  
**我想要** 使用生物辨識或 PIN 碼來鎖定應用程式  
**以便** 保護我的隱私資料不被他人查看

**驗收標準:**
- [x] 首次啟動時可以設定 PIN 碼
- [x] 支援指紋/臉部辨識解鎖(如果裝置支援)
- [x] 每次進入應用程式時需要驗證
- [x] 提供 PIN 碼後備方案
- [x] 可在設定中開啟/關閉鎖定功能
- [x] PIN 碼輸入驗證 (4-6 位數字)
- [x] 生物辨識可用性檢測
- [x] 應用切換到背景時自動鎖定
- [x] 使用加密儲存保存 PIN 碼

**實作狀態:** ✅ 已完成 - BiometricHelper + PinSetupDialog + 完整鎖定流程

---

## Epic 2: 每日記錄管理

### US-002: 建立每日記錄
**作為** 一位佩戴者  
**我想要** 每天填寫關於我的身體狀態、心情和活動的詳細問卷  
**以便** 追蹤我的日常體驗

**驗收標準:**
- [x] 提供包含 23 個維度的表單界面
- [x] 表單分類清晰(心理、生理、社交等)
- [x] 支援多種輸入類型(選擇、滑桿、時長、複選等)
- [x] 可選擇性別相關問題(勃起、夜間勃起等)
- [x] 儲存成功後顯示確認訊息
- [x] 漸進式揭露設計:
  - 10個核心問題(約3分鐘)
  - 8個條件觸發問題(根據回答顯示)
  - 1個每日輪替問題(5選1)
  - 分步驟導航與進度追蹤

**23 個維度包括:**
1. 心情選擇
2. 色情內容觀看(是/否 + 時長)
3. 勃起狀況(次數) - 男性限定
4. 運動(類型 + 時長)
5. 是否解鎖/自慰(時長)
6. 裝置露出(地點)
7. 照片打卡
8. 性慾強度(1-10)
9. 舒適度評分(1-5)
10. 不適/疼痛(部位 + 程度)
11. 清潔方式
12. 洩漏狀況(程度)
13. 邊緣訓練(時長 + 方法)
14. Keyholder 互動(類型)
15. 睡眠品質(1-5 + 是否因裝置醒來)
16. 臨時取下(時長 + 原因)
17. 夜間勃起(次數 + 是否醒來) - 男性限定
18. 專注度(1-10)
19. 完成任務(列表)
20. 細緻情緒(多選標籤)
21. 裝置檢查
22. 社交活動(焦慮程度)
23. 備註欄位

**實作狀態:** ✅ 已完成 - 漸進式表單 UI 完整實作

---

### US-003: 編輯歷史記錄
**作為** 一位用戶  
**我想要** 能夠編輯過去的日記記錄  
**以便** 修正錯誤或補充遺漏的資訊

**驗收標準:**
- [x] 從儀表板或日曆檢視點擊歷史記錄
- [x] 顯示已填寫的資料
- [x] 可以修改並儲存
- [x] 顯示最後編輯時間
- [x] Material 3 日期選擇器整合
- [x] TopAppBar 顯示日期與編輯狀態
- [x] 區分「儲存記錄」與「更新記錄」按鈕文字
- [x] 編輯模式顯示創建時間與最後編輯時間

**實作狀態:** ✅ 已完成 - DatePickerDialog + DailyEntryScreen 日期選擇整合

---

### US-004: 刪除記錄
**作為** 一位用戶  
**我想要** 能夠刪除不需要的記錄  
**以便** 保持資料的準確性

**驗收標準:**
- [x] 提供刪除按鈕 (TopAppBar 紅色 Delete 圖標)
- [x] 刪除前顯示確認對話框
- [x] 刪除後更新統計資料
- [x] 刪除成功後顯示 Snackbar 提示
- [x] 僅在編輯模式 (entryId != 0) 顯示刪除按鈕
- [x] 刪除後自動切換回今日日期
- [x] Warning 圖標 + 紅色主題強調警告意味

**實作狀態:** ✅ 已完成 - DeleteConfirmDialog + DailyEntryViewModel.deleteEntry()

---

## Epic 3: 統計與數據視覺化

### US-005: 檢視統計儀表板
**作為** 一位用戶  
**我想要** 看到我的記錄統計圖表  
**以便** 了解我的長期趨勢和模式

**驗收標準:**
- [x] 顯示總記錄天數
- [x] 顯示連續打卡天數
- [x] 心情趨勢圖表(折線圖) - Vico 庫實作
- [x] 運動頻率統計(長條圖) - 按類型分組統計
- [x] 性慾強度趨勢 - 折線圖(1-10)
- [x] 舒適度平均值 - 折線圖(1-5)
- [x] 支援時間範圍切換(7天/30天/90天/全部)
- [x] 日曆熱力圖(7天記錄完成度)
- [x] 統計卡片(平均性慾、運動次數等)

**實作狀態:** ✅ 已完成 - Vico 圖表完整實作,含測試數據生成器

---

### US-006: 查看連續打卡成就
**作為** 一位用戶  
**我想要** 看到我的連續打卡紀錄和里程碑  
**以便** 激勵自己持續記錄

**驗收標準:**
- [x] 顯示當前連續天數
- [x] 顯示最長連續天數
- [x] 里程碑徽章(7天、30天、100天等)
- [x] 打卡日曆視圖
- [x] 里程碑進度條（顯示距離下個徽章還差幾天）
- [x] 已解鎖徽章高亮，未解鎖灰色顯示
- [x] 6個等級：初學者/進展中/一個月/兩個月/百日勇士/一年達人

**實作狀態:** ✅ 已完成 - StreakBadgesSection + StreakBadge 元件整合至儀表板

---

## Epic 4: 個人化設定

### US-007: 個人資料設定
**作為** 一位用戶  
**我想要** 設定我的個人資料  
**以便** 應用程式能根據我的情況調整問卷

**驗收標準:**
- [x] 選擇性別(影響顯示問題)
- [x] 設定開始佩戴日期
- [x] 設定身高(可選,100-250 cm)
- [x] 設定體重(可選,30-200 kg)
- [x] BMI 自動計算與健康狀態顯示
- [x] 設定貞操裝置名稱(可選)
- [x] 提供編輯對話框與輸入驗證

**實作狀態:** ✅ 已完成 - 完整個人資料管理功能

---

### US-008: 每日提醒通知
**作為** 一位用戶  
**我想要** 設定每日提醒時間  
**以便** 不會忘記填寫日記

**驗收標準:**
- [x] 可選擇提醒時間(預設 21:00)
- [x] 可開啟/關閉提醒
- [x] 通知內容友善且隱密
- [x] 點擊通知後直接進入記錄頁面
- [x] Material 3 時間選擇器
- [x] Android 13+ 通知權限處理
- [x] WorkManager 定時任務整合
- [x] 已有記錄時不發送通知

**實作狀態:** ✅ 已完成 - DailyReminderWorker + TimePickerDialog + 權限處理

---

### US-009: 主題與顯示設定
**作為** 一位用戶  
**我想要** 自訂應用程式的外觀  
**以便** 符合我的使用偏好

**驗收標準:**
- [ ] 支援淺色/深色/跟隨系統主題
- [ ] Material Design 3 動態顏色(Android 12+)
- [ ] 字體大小調整

**實作狀態:** ✅ 已完成 - Theme.kt 實作完整

---

## Epic 5: 資料管理

### US-010: 雲端備份與同步
**作為** 一位用戶  
**我想要** 將我的資料備份到雲端  
**以便** 在換裝置時不會遺失資料

**驗收標準:**
- [ ] 可選擇啟用 Firebase 同步
- [ ] 自動備份每日記錄
- [ ] 同步用戶設定
- [ ] 顯示最後同步時間
- [ ] 手動觸發同步功能

**實作狀態:** 📋 待實作 (Firebase 已配置)

---

### US-011: 匯出資料
**作為** 一位用戶  
**我想要** 匯出我的日記資料  
**以便** 進行個人分析或備份

**驗收標準:**
- [ ] 支援匯出為 CSV 格式
- [ ] 支援匯出為 JSON 格式
- [ ] 可選擇匯出日期範圍
- [ ] 包含所有欄位資料

**實作狀態:** 📋 待實作

---

### US-012: 匯入資料
**作為** 一位用戶  
**我想要** 從備份檔案匯入資料  
**以便** 恢復之前的記錄

**驗收標準:**
- [ ] 支援 CSV/JSON 格式
- [ ] 資料驗證檢查
- [ ] 避免重複記錄
- [ ] 顯示匯入進度

**實作狀態:** 📋 待實作

---

## Epic 6: 進階功能

### US-013: 照片打卡功能
**作為** 一位用戶  
**我想要** 在每日記錄中附加照片  
**以便** 視覺化記錄我的狀態

**驗收標準:**
- [ ] 從相機拍攝照片
- [ ] 從相簿選擇照片
- [ ] 照片壓縮儲存
- [ ] 照片隱私保護(不出現在系統相簿)
- [ ] 可以刪除照片

**實作狀態:** 📋 待實作 (photoPath 欄位已存在)

---

### US-014: 任務管理系統
**作為** 一位用戶  
**我想要** 記錄 Keyholder 指派的任務完成狀況  
**以便** 追蹤我的服從度

**驗收標準:**
- [ ] 建立任務列表
- [ ] 標記任務完成
- [ ] 任務歷史記錄
- [ ] 完成率統計

**實作狀態:** 📋 待實作 (completedTasks 欄位已存在)

---

### US-015: 情緒分析
**作為** 一位用戶  
**我想要** 看到我的情緒變化分析  
**以便** 了解佩戴對心理的影響

**驗收標準:**
- [ ] 情緒趨勢圖表
- [ ] 情緒詞雲
- [ ] 正面/負面情緒比例
- [ ] 情緒與其他變數的相關性分析

**實作狀態:** 📋 待實作 (emotions 欄位已存在)

---

## 優先級排序

### P0 - 核心功能 (必須完成)
1. US-002: 建立每日記錄 (表單 UI 完整實作)
2. US-005: 統計儀表板 (圖表實作)
3. US-001: 應用程式鎖定 (LockScreen 整合)

### P1 - 重要功能
4. US-008: 每日提醒通知
5. US-003: 編輯歷史記錄
6. US-006: 連續打卡成就

### P2 - 增強功能
7. US-013: 照片打卡
8. US-010: 雲端同步
9. US-011: 匯出資料

### P3 - 進階功能
10. US-014: 任務管理
11. US-015: 情緒分析
12. US-004: 刪除記錄

---

## 技術實作檢查清單

### 已完成 ✅
- [x] Room Database 架構
- [x] MVVM 架構設定
- [x] Material Design 3 主題
- [x] 底部導航
- [x] DataStore 偏好設定
- [x] DailyEntry 23 個欄位資料模型
- [x] ViewModel 狀態管理
- [x] Repository 層

### 進行中 ⚠️
- [ ] DailyEntryScreen UI 表單元件實作
- [ ] Dashboard 圖表整合
- [ ] LockScreen 生物辨識整合

### 待開始 📋
- [ ] 照片上傳與管理
- [ ] 通知系統整合
- [ ] Firebase 同步邏輯
- [ ] 資料匯入/匯出
- [ ] 任務管理功能
- [ ] 進階統計分析

---

## 估算工時 (開發日)

| Epic | 預估工時 |
|------|---------|
| Epic 1: 用戶認證 | 2 天 |
| Epic 2: 記錄管理 | 5 天 |
| Epic 3: 統計視覺化 | 4 天 |
| Epic 4: 個人化設定 | 2 天 |
| Epic 5: 資料管理 | 3 天 |
| Epic 6: 進階功能 | 5 天 |
| **總計** | **21 天** |

---

## 下一步行動

1. **立即開始**: 完成 DailyEntryScreen 的 23 個問題表單 UI
2. **本週目標**: 整合圖表庫到 DashboardScreen
3. **本月目標**: 完成 P0 和 P1 的所有功能
